<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>TÃ i chÃ­nh gia Ä‘Ã¬nh</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --primary:#2ecc71;
  --bg:#f1f3f6;
  --card:#fff;
  --text:#333;
}
body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);
  margin:0;
  padding:12px;
  color:var(--text);
}
h1{text-align:center;margin-bottom:10px}
.card{
  background:var(--card);
  border-radius:18px;
  padding:16px;
  margin-bottom:14px;
  box-shadow:0 6px 16px rgba(0,0,0,.08);
}
button,input,select{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:12px;
  border:1px solid #ddd;
}
button{
  background:var(--primary);
  color:#fff;
  border:none;
  font-weight:600;
}
.row{display:flex;gap:8px}
.row>*{flex:1}
.item{display:flex;justify-content:space-between;margin-top:6px}
.small{font-size:13px;color:#777}
.good{color:#27ae60;font-weight:600}
.warn{color:#e67e22;font-weight:600}
.bad{color:#c0392b;font-weight:600}
.progress{
  background:#eee;
  border-radius:10px;
  overflow:hidden;
  height:10px;
  margin-top:6px;
}
.progress div{
  height:100%;
  background:var(--primary);
}
</style>
</head>

<body>

<h1>ğŸ¦ TÃ i chÃ­nh gia Ä‘Ã¬nh</h1>

<!-- DASHBOARD -->
<div class="card">
<h3>ğŸ“Š Tá»•ng quan</h3>
<div id="dashboard"></div>
</div>

<!-- INCOME -->
<div class="card">
<h3>ğŸ’¼ Thu nháº­p gia Ä‘Ã¬nh / thÃ¡ng</h3>
<input id="income" type="number" placeholder="VD: 40000000">
<button onclick="saveIncome()">LÆ°u</button>
</div>

<!-- EXPENSE -->
<div class="card">
<h3>â• Chi tiÃªu</h3>
<div class="row">
<input id="amount" type="number" placeholder="Sá»‘ tiá»n">
<select id="category">
<option>Ä‚n uá»‘ng</option><option>Äi chá»£</option>
<option>NhÃ  á»Ÿ</option><option>GiÃ¡o dá»¥c</option>
<option>Di chuyá»ƒn</option><option>Du lá»‹ch</option>
<option>KhÃ¡c</option>
</select>
</div>
<button onclick="addExpense()">LÆ°u</button>
</div>

<div class="card">
<h3>ğŸ“‰ Biá»ƒu Ä‘á»“ chi tiÃªu</h3>
<canvas id="expenseChart"></canvas>
</div>

<!-- GOALS -->
<div class="card">
<h3>ğŸ  Má»¥c tiÃªu mua BÄS</h3>
<input id="houseTarget" type="number" placeholder="Sá»‘ tiá»n cáº§n">
<input id="houseMonths" type="number" placeholder="Sá»‘ thÃ¡ng (24â€“36)">
<button onclick="calcHouse()">TÃ­nh</button>
<div id="houseResult"></div>
</div>

<!-- SCENARIO -->
<div class="card">
<h3>ğŸ”® Ká»‹ch báº£n thu nháº­p</h3>
<select onchange="scenario(this.value)">
<option value="1">Hiá»‡n táº¡i</option>
<option value="0.8">Giáº£m 20%</option>
<option value="1.3">TÄƒng 30%</option>
</select>
<div id="scenarioResult"></div>
</div>

<!-- BACKUP -->
<div class="card">
<h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ DÃ¹ng chung & Backup</h3>
<button onclick="exportData()">Xuáº¥t dá»¯ liá»‡u</button>
<input type="file" onchange="importData(this.files[0])">
<p class="small">DÃ¹ng Ä‘á»ƒ chia sáº» vá»£ â€“ chá»“ng / Ä‘á»•i mÃ¡y</p>
</div>

<script>
let expenses=JSON.parse(localStorage.getItem("expenses")||"[]");
let income=+localStorage.getItem("income")||0;
let house=JSON.parse(localStorage.getItem("house")||"{}");

function saveIncome(){
 income=+document.getElementById("income").value;
 localStorage.setItem("income",income);
 render();
}

function addExpense(){
 let a=+amount.value;
 if(!a)return;
 expenses.push({a,cat:category.value});
 localStorage.setItem("expenses",JSON.stringify(expenses));
 amount.value="";
 render();
}

function calcHouse(){
 let t=+houseTarget.value;
 let m=+houseMonths.value;
 if(!t||!m)return;
 house={t,m};
 localStorage.setItem("house",JSON.stringify(house));
 render();
}

function scenario(rate){
 let inc=income*rate;
 let need=house.t/house.m||0;
 let html=`<p>Thu nháº­p: <strong>${Math.round(inc).toLocaleString()}Ä‘</strong></p>`;
 html+= inc*0.3>=need
 ? `<p class="good">âœ” Váº«n Ä‘áº¡t má»¥c tiÃªu mua BÄS</p>`
 : `<p class="bad">âŒ Cáº§n giáº£m chi tiÃªu / tÄƒng tiáº¿t kiá»‡m</p>`;
 scenarioResult.innerHTML=html;
}

function exportData(){
 let data={expenses,income,house};
 let blob=new Blob([JSON.stringify(data)],{type:"application/json"});
 let a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="taichinh_giadinh.json";
 a.click();
}

function importData(file){
 let r=new FileReader();
 r.onload=e=>{
  let d=JSON.parse(e.target.result);
  expenses=d.expenses||[];
  income=d.income||0;
  house=d.house||{};
  localStorage.setItem("expenses",JSON.stringify(expenses));
  localStorage.setItem("income",income);
  localStorage.setItem("house",JSON.stringify(house));
  render();
 };
 r.readAsText(file);
}

function render(){
 let totalExp=expenses.reduce((s,e)=>s+e.a,0);
 let save=income-totalExp;
 let dash=`
 <div class="item"><span>Thu nháº­p</span><strong>${income.toLocaleString()}Ä‘</strong></div>
 <div class="item"><span>Chi tiÃªu</span><strong>${totalExp.toLocaleString()}Ä‘</strong></div>
 <div class="item"><span>Tiáº¿t kiá»‡m</span><strong>${save.toLocaleString()}Ä‘</strong></div>
 `;
 if(house.t){
  let p=Math.min(save/ (house.t/house.m)*100,100);
  dash+=`<p class="small">Tiáº¿n Ä‘á»™ mua BÄS</p>
  <div class="progress"><div style="width:${p}%"></div></div>`;
 }
 dashboard.innerHTML=dash;

 let sum={};
 expenses.forEach(e=>sum[e.cat]=(sum[e.cat]||0)+e.a);
 if(window.chart)chart.destroy();
 chart=new Chart(expenseChart,{
  type:"doughnut",
  data:{labels:Object.keys(sum),datasets:[{data:Object.values(sum)}]}
 });
}
render();
</script>

</body>
</html>
